<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Spectrum Filter - Accessible Editor - Prototype 1</title>
  </head>
  <body>
	  <h1>Spectrum Filter - Accessible Editor - Prototype 1</h1>
    <p>
      This prototype provides only a small part of the functionality of the original editor.
      Its goal is to test a potential interface for the functionality.
    </p>
    <div id="parameter">
      <select id="groups">
        <!-- The values of these options have to be the same as the names of the highest-level
        groupings in the `data` JS object -->
        <option value="masterControls">masterControls</option>
        <option value="envelope1">envelope1</option>
        <option value="envelope1">envelope2</option>
      </select>
      <select id="parameters"> <!-- Generated by JS --> </select>
    </div>
    
    <div id="values"> <!-- Generated by JS -->  </div>
    <div id="status" role="status"></div>

    <div style="position: static !important;"></div>
  </body>
</html>


<script>

  const data = {
    masterControls: {
      options: ['noOptions'],
      values: ["input1Gain", "input2Gain", "masterDepth", "modSource", "bass",
                "treble", "mix", "loRetain", "outputVolume", "outputBalance"],
    },
    envelope1: {
      options: ['fastAttack', 'fastestAttack', 'wideRange1', 'wideRange2', 'snappy',
                'swell', 'ADSR1', 'ADSR2', 'ADSR3', 'ADSR4', 'ADSR5', 'ADSR6'],
      values: ['speed', 'sensitivity', 'gate'],
    },
    envelope2: {
      options: ['fastAttack', 'fastestAttack', 'wideRange1', 'wideRange2', 'snappy',
                'swell', 'ADSR1', 'ADSR2', 'ADSR3', 'ADSR4', 'ADSR5', 'ADSR6'],
      values: ['speed', 'sensitivity', 'gate'],
    },
  };
  
  
  const groups = document.querySelector("#groups");
  const parameters = document.querySelector("#parameters");
  
  groups.addEventListener("change", () => display(data[groups.value].options, parameters));
  groups.addEventListener("change", () => displayValues(data, groups.value));
  
  display(data, groups);
  display(data[groups.value].options, parameters);
  (Object.keys(data)).map(group => values(group, data[group].values, document.getElementById("values")));
  displayValues(data, groups.value);
  
  function values (group, data, dom) {
    for (let name of data) {
      const div = document.createElement("div");
      div.setAttribute('id', `${group}-${name}-value`);
      div.setAttribute('style', 'display: none;');
      div.setAttribute('aria-hidden', 'true');
      
      const label = document.createElement("label");
      label.setAttribute("id", `${group}-${name}`);
      label.innerText = name + ":"
      div.appendChild(label);

      const input = document.createElement("input");
      input.setAttribute("type", "number");
      input.setAttribute("aria-labelledby", `${group}-${name}`);
      input.setAttribute("class", "number");
      input.setAttribute("min", 0);
      input.setAttribute("max", 254);
      div.appendChild(input);

      dom.appendChild(div);
    }
  }

  function display (data, dom) {
    dom.innerHTML = "";
    if (not(data instanceof Array)) data = Object.keys(data);
    for (let name of data) {
      const option = document.createElement("option");
      option.textContent = name;
      option.setAttribute("value", name);
      dom.add(option);
    }
  }
  
  function displayValues (data, group) {
    for (let name of Object.keys(data)) {
      if (name == group) {  // Set values visible
        for (let value of data[name].values) {
          const div = document.getElementById(`${name}-${value}-value`);
          div.setAttribute('style', 'display: block;');
          div.setAttribute('aria-hidden', 'false');
        }
      } else {  // Set hidden
        for (let value of data[name].values) {
          const div = document.getElementById(`${name}-${value}-value`);
          div.setAttribute('style', 'display: none;');
          div.setAttribute('aria-hidden', 'true');
        }
      }
    }
  }
  
  function not (x) {return !x;}
  
  </script>